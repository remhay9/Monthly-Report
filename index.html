<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Monthly Payment Tracker</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
    body {
        background-color: #f8f9fa;
    }
    .container {
        max-width: 900px;
        margin-top: 20px;
    }
    /* Make table scrollable on mobile */
    .table-responsive {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
    }
    /* Reduce padding on small screens */
    @media (max-width: 576px) {
        h2 {
            font-size: 1.4rem;
        }
        .form-label {
            font-size: 0.9rem;
        }
        .btn {
            font-size: 0.9rem;
        }
    }
</style>
</head>
<body>

<div class="container" id="loginSection">
    <h2 class="text-center mb-4">üîê Login</h2>
    <div class="card shadow-sm p-3">
        <form id="loginForm">
            <div class="mb-3">
                <label class="form-label">Username</label>
                <input type="text" id="username" class="form-control" placeholder="Enter username" required>
            </div>
            <div class="mb-3">
                <label class="form-label">Password</label>
                <input type="password" id="password" class="form-control" placeholder="Enter password" required>
            </div>
            <button type="submit" class="btn btn-primary w-100">Login</button>
        </form>
    </div>
</div>

<div class="container d-none" id="trackerSection">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="mb-0">üí∞ Monthly Payment Tracker</h2>
        <button class="btn btn-danger btn-sm" onclick="logout()">Logout</button>
    </div>

    <!-- Form -->
    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <form id="expenseForm" class="row g-2">
                <div class="col-12 col-md-4">
                    <label class="form-label">Date</label>
                    <input type="date" id="date" class="form-control" required>
                </div>
                <div class="col-12 col-md-4">
                    <label class="form-label">Description</label>
                    <input type="text" id="description" class="form-control" placeholder="e.g., Electricity bill" required>
                </div>
                <div class="col-12 col-md-4">
                    <label class="form-label">Amount ($)</label>
                    <input type="number" id="amount" class="form-control" step="0.01" required>
                </div>
                <div class="col-12">
                    <button type="submit" class="btn btn-primary w-100">Add Payment</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Summary -->
    <div class="alert alert-success text-center">
        <strong>Total This Month:</strong> $<span id="totalMonth">0.00</span>
    </div>

    <!-- Table -->
    <div class="card shadow-sm">
        <div class="card-body table-responsive">
            <table class="table table-bordered text-center align-middle">
                <thead class="table-dark">
                    <tr>
                        <th>Date</th>
                        <th>Description</th>
                        <th>Amount ($)</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="expenseTable"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
let expenses = [];
let currentUser = "";

// Render Table
function renderTable() {
    let table = document.getElementById("expenseTable");
    table.innerHTML = "";
    let totalMonth = 0;
    const currentMonth = new Date().getMonth();
    const currentYear = new Date().getFullYear();

    expenses.forEach((exp, index) => {
        let expDate = new Date(exp.date);
        if (expDate.getMonth() === currentMonth && expDate.getFullYear() === currentYear) {
            totalMonth += parseFloat(exp.amount);
        }

        table.innerHTML += `
            <tr>
                <td>${exp.date}</td>
                <td>${exp.description}</td>
                <td>$${parseFloat(exp.amount).toFixed(2)}</td>
                <td>
                    <button class="btn btn-sm btn-warning" onclick="editExpense(${index})">Edit</button>
                    <button class="btn btn-sm btn-danger" onclick="deleteExpense(${index})">Delete</button>
                </td>
            </tr>
        `;
    });

    document.getElementById("totalMonth").textContent = totalMonth.toFixed(2);
    localStorage.setItem("expenses_" + currentUser, JSON.stringify(expenses));
}

// Add Expense
document.getElementById("expenseForm").addEventListener("submit", function(e) {
    e.preventDefault();
    const date = document.getElementById("date").value;
    const description = document.getElementById("description").value;
    const amount = document.getElementById("amount").value;

    expenses.push({ date, description, amount });
    renderTable();
    this.reset();
});

// Delete Expense
function deleteExpense(index) {
    if (confirm("Are you sure you want to delete this record?")) {
        expenses.splice(index, 1);
        renderTable();
    }
}

// Edit Expense
function editExpense(index) {
    const exp = expenses[index];
    document.getElementById("date").value = exp.date;
    document.getElementById("description").value = exp.description;
    document.getElementById("amount").value = exp.amount;
    expenses.splice(index, 1);
    renderTable();
}

// Login Function
document.getElementById("loginForm").addEventListener("submit", function(e) {
    e.preventDefault();
    const user = document.getElementById("username").value.trim().toLowerCase();
    const pass = document.getElementById("password").value;

    if ((user === "remhay" || user === "sophana") && pass === "Sophanahay010525") {
        currentUser = user;
        expenses = JSON.parse(localStorage.getItem("expenses_" + currentUser)) || [];
        document.getElementById("loginSection").classList.add("d-none");
        document.getElementById("trackerSection").classList.remove("d-none");
        renderTable();
    } else {
        alert("Invalid username or password!");
    }
});

// Logout Function
function logout() {
    currentUser = "";
    expenses = [];
    document.getElementById("loginSection").classList.remove("d-none");
    document.getElementById("trackerSection").classList.add("d-none");
}
</script>

</body>
</html>
